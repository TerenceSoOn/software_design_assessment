@startuml
title FlirtNet Core Flow: Random Matching to Datemate Connection

|User A|
start
:Open Random Match;

|#LightBlue|Matching Service|
:Check for available users;

if (Real User Available?) then (yes)
  |#LightGreen|AI Matching Assistant|
  :Calculate compatibility score\nbased on interests & profile;
  
  |#LightBlue|Matching Service|
  :Pair User A with User B;
  
  |User A|
  :View basic profile of User B;
  
  |User B|
  :View basic profile of User A;
  
  |#LightBlue|Chat Service|
  :Start Random Chat Session;
  
  repeat
    fork
      |User A|
      :Type message;
      
      |#Orange|AI Safety Detector|
      if (Content is abusive/harmful?) then (yes)
        :Block message;
        :Send warning to User A;
        stop
      endif
      
      |User B|
      :Receive message;
      
    fork again
      |User B|
      :Type message;
      
      |#Orange|AI Safety Detector|
      if (Content is abusive/harmful?) then (yes)
        :Block message;
        :Send warning to User B;
        stop
      endif
      
      |User A|
      :Receive message;
    end fork
    
    |#LightGreen|AI Atmosphere Analyzer|
    :Analyze conversation mood\nand tone;
    :Update atmosphere score;
    
    fork
      |User A|
      if (Request AI Wingman help?) then (yes)
        |#LightGreen|AI Wingman|
        :Analyze context & User B profile;
        :Generate conversation suggestions;
        |User A|
        :View suggestions;
      endif
    fork again
      |User B|
      if (Request AI Wingman help?) then (yes)
        |#LightGreen|AI Wingman|
        :Analyze context & User A profile;
        :Generate conversation suggestions;
        |User B|
        :View suggestions;
      endif
    end fork
    
  repeat while (Chat continues?) is (yes)
  
  |User A|
  if (Send Datemate Request?) then (yes)
    |#LightBlue|Connection Service|
    :Create pending connection;
    :Notify User B;
    
    |User B|
    :Receive request notification;
    if (Accept request?) then (yes)
      |#LightBlue|Connection Service|
      :Establish datemate connection;
      :Add to both Datemate Lists;
      :Enable private chat;
      
      |User A|
      :Access private chat with User B;
      
      |User B|
      :Access private chat with User A;
      
      stop
    else (reject)
      |#LightBlue|Connection Service|
      :End session;
      stop
    endif
  else (no)
    :End chat session;
    stop
  endif

else (no user available)
  |#LightGreen|AI Companion|
  :Offer AI Companion chat;
  
  |User A|
  if (Accept AI Companion?) then (yes)
    :Chat with AI Bot;
    note right
      AI simulates realistic
      conversation partner
    end note
    stop
  else (no)
    :Return to wait queue;
    stop
  endif
endif

@enduml
