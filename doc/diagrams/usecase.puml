@startuml
left to right direction
skinparam packageStyle rectangle

actor "User" as U
actor "AI System" as AI

rectangle "User Management" {
  usecase "Register/Login" as UC_Auth
  usecase "Edit Profile" as UC_EditProfile
  usecase "Manage Photo Wall" as UC_Photos
}

rectangle "Discovery (Random Match)" {
  usecase "Start Random Match" as UC_Match
  usecase "Chat with Stranger" as UC_ChatRandom
  usecase "View Stranger Profile" as UC_ViewProfile
  usecase "Send Datemate Request" as UC_SendReq_Match
}

rectangle "Datemate System" {
  usecase "Accept/Reject Request" as UC_HandleReq
  usecase "Private Chat with Datemate" as UC_ChatPrivate
  usecase "View Datemate List" as UC_ViewDatemates
}

rectangle "Public Square" {
  usecase "Publish Post" as UC_Post
  usecase "Comment/Like Post" as UC_Interact
  usecase "Send Datemate Request from Post" as UC_SendReq_Post
  usecase "Follow Topics/Tags" as UC_Follow
}

rectangle "AI Services" {
  usecase "Chat with AI Companion" as UC_AI_Companion
  usecase "Chat with Miss Ex AI" as UC_AI_Ex
  usecase "AI Practice Mode" as UC_AI_Practice
  usecase "Get AI Wingman Advice" as UC_AI_Wingman
  usecase "View Atmosphere Analysis" as UC_AI_Atmosphere
  usecase "Get Profile Optimization Tips" as UC_AI_Profile
  usecase "Real-time Abuse Detection" as UC_AI_Safety
  usecase "Intelligent Matching Assistant" as UC_AI_Matching
}

' User Management
U --> UC_Auth
U --> UC_EditProfile
U --> UC_Photos
UC_EditProfile ..> UC_AI_Profile : <<extend>>

' Discovery Flow
U --> UC_Match
UC_Match ..> UC_ChatRandom : <<include>>
UC_ChatRandom ..> UC_ViewProfile : <<include>>
UC_ChatRandom ..> UC_AI_Wingman : <<extend>>
UC_ChatRandom ..> UC_AI_Atmosphere : <<include>>
UC_ChatRandom ..> UC_AI_Safety : <<include>>
UC_ChatRandom ..> UC_SendReq_Match : <<extend>>

' AI Companion Fallback
UC_Match ..> UC_AI_Companion : <<extend>>\n(no match found)

' Matching Assistant
UC_Match ..> UC_AI_Matching : <<include>>

' Datemate System
U --> UC_HandleReq
UC_SendReq_Match --> UC_HandleReq
UC_SendReq_Post --> UC_HandleReq
UC_HandleReq ..> UC_ViewDatemates : <<include>>\n(after acceptance)

U --> UC_ChatPrivate
U --> UC_ViewDatemates
UC_ChatPrivate ..> UC_AI_Safety : <<include>>

' Public Square
U --> UC_Post
U --> UC_Interact
U --> UC_Follow
UC_Interact ..> UC_SendReq_Post : <<extend>>
UC_Post ..> UC_AI_Safety : <<include>>

' Standalone AI Features
U --> UC_AI_Ex
U --> UC_AI_Practice

' AI Actor Relationships
AI --> UC_AI_Companion
AI --> UC_AI_Ex
AI --> UC_AI_Practice
AI --> UC_AI_Wingman
AI --> UC_AI_Atmosphere
AI --> UC_AI_Profile
AI --> UC_AI_Safety
AI --> UC_AI_Matching

@enduml
